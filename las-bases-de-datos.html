<!DOCTYPE html>
<html lang="es-ES" xml:lang="es-ES">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> 3 Las bases de datos | Manual de uso de scritps de automatización de tabulados de Registros Administrativos de Seguridad Pública y Justicia</title>
  <meta name="description" content="Instrucciones y reglas de uso del script de automaización de tabulados y validaciones para Registros Administrativos de Seguridad Pública y Justicia" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content=" 3 Las bases de datos | Manual de uso de scritps de automatización de tabulados de Registros Administrativos de Seguridad Pública y Justicia" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Instrucciones y reglas de uso del script de automaización de tabulados y validaciones para Registros Administrativos de Seguridad Pública y Justicia" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" 3 Las bases de datos | Manual de uso de scritps de automatización de tabulados de Registros Administrativos de Seguridad Pública y Justicia" />
  
  <meta name="twitter:description" content="Instrucciones y reglas de uso del script de automaización de tabulados y validaciones para Registros Administrativos de Seguridad Pública y Justicia" />
  

<meta name="author" content="Daniel M. Giménez" />


<meta name="date" content="2021-02-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="presentación-de-la-segunda-parte.html"/>
<link rel="next" href="el-diccionario.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Manual: Scripts de Automatización de RRAA</a></li>      

<li class="divider"></li>
<li class="part"><span><b>PORTADA</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Presentación</a></li>
<li class="part"><span><b>PRIMERA PARTE: EL SISTEMA DE SCRIPTS</b></span></li>
<li class="chapter" data-level="" data-path="presentación-de-la-primera-parte.html"><a href="presentación-de-la-primera-parte.html"><i class="fa fa-check"></i>Presentación de la primera parte</a></li>
<li class="chapter" data-level="1" data-path="la-perspectiva-de-automatización-aplicada.html"><a href="la-perspectiva-de-automatización-aplicada.html"><i class="fa fa-check"></i><b>1</b> La perspectiva de automatización aplicada</a>
<ul>
<li class="chapter" data-level="1.1" data-path="la-perspectiva-de-automatización-aplicada.html"><a href="la-perspectiva-de-automatización-aplicada.html#la-solución-de-programadora"><i class="fa fa-check"></i><b>1.1</b> La solución de “programador/a”</a></li>
<li class="chapter" data-level="1.2" data-path="la-perspectiva-de-automatización-aplicada.html"><a href="la-perspectiva-de-automatización-aplicada.html#la-solución-de-usuarioa-de-excel"><i class="fa fa-check"></i><b>1.2</b> La solución de usuario/a de Excel</a></li>
<li class="chapter" data-level="1.3" data-path="la-perspectiva-de-automatización-aplicada.html"><a href="la-perspectiva-de-automatización-aplicada.html#el-control-del-flujo"><i class="fa fa-check"></i><b>1.3</b> El control del flujo</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reglas-de-formato-y-convenciones-del-manual.html"><a href="reglas-de-formato-y-convenciones-del-manual.html"><i class="fa fa-check"></i><b>2</b> Reglas de formato y convenciones del Manual</a>
<ul>
<li class="chapter" data-level="2.1" data-path="reglas-de-formato-y-convenciones-del-manual.html"><a href="reglas-de-formato-y-convenciones-del-manual.html#formatos-para-los-scripts"><i class="fa fa-check"></i><b>2.1</b> Formatos para los scripts</a></li>
<li class="chapter" data-level="2.2" data-path="reglas-de-formato-y-convenciones-del-manual.html"><a href="reglas-de-formato-y-convenciones-del-manual.html#formatos_manual"><i class="fa fa-check"></i><b>2.2</b> Formatos de codigo en este manual</a></li>
</ul></li>
<li class="part"><span><b>SEGUNDA PARTE: LA FASE MANUAL</b></span></li>
<li class="chapter" data-level="" data-path="presentación-de-la-segunda-parte.html"><a href="presentación-de-la-segunda-parte.html"><i class="fa fa-check"></i>Presentación de la segunda parte</a></li>
<li class="chapter" data-level="3" data-path="las-bases-de-datos.html"><a href="las-bases-de-datos.html"><i class="fa fa-check"></i><b>3</b> Las bases de datos</a>
<ul>
<li class="chapter" data-level="3.1" data-path="las-bases-de-datos.html"><a href="las-bases-de-datos.html#los-formatos-admitidos"><i class="fa fa-check"></i><b>3.1</b> Los formatos admitidos</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="las-bases-de-datos.html"><a href="las-bases-de-datos.html#la-base-de-datos-la-unidad-fundamental"><i class="fa fa-check"></i><b>3.1.1</b> La base de datos: la unidad fundamental</a></li>
<li class="chapter" data-level="3.1.2" data-path="las-bases-de-datos.html"><a href="las-bases-de-datos.html#verificación-de-la-integridad-de-las-bases-de-datos"><i class="fa fa-check"></i><b>3.1.2</b> Verificación de la integridad de las bases de datos</a></li>
<li class="chapter" data-level="3.1.3" data-path="las-bases-de-datos.html"><a href="las-bases-de-datos.html#qué-observar-al-realizar-la-verificación-de-integridad"><i class="fa fa-check"></i><b>3.1.3</b> ¿Qué observar al realizar la verificación de integridad?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="las-bases-de-datos.html"><a href="las-bases-de-datos.html#el-ajuste-de-la-estructura-y-los-tipos-de-información-de-las-bases-de-datos"><i class="fa fa-check"></i><b>3.2</b> El ajuste de la estructura y los tipos de información de las bases de datos</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="las-bases-de-datos.html"><a href="las-bases-de-datos.html#la-limpieza-de-la-base-de-datos"><i class="fa fa-check"></i><b>3.2.1</b> La limpieza de la base de datos</a></li>
<li class="chapter" data-level="3.2.2" data-path="las-bases-de-datos.html"><a href="las-bases-de-datos.html#los-tipos-de-información-de-las-celdas"><i class="fa fa-check"></i><b>3.2.2</b> Los tipos de información de las celdas</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="las-bases-de-datos.html"><a href="las-bases-de-datos.html#unificación-de-bases-de-datos-divididas-en-múltiples-archivos"><i class="fa fa-check"></i><b>3.3</b> Unificación de bases de datos divididas en múltiples archivos</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="el-diccionario.html"><a href="el-diccionario.html"><i class="fa fa-check"></i><b>4</b> El diccionario</a>
<ul>
<li class="chapter" data-level="4.1" data-path="el-diccionario.html"><a href="el-diccionario.html#visión-general-del-diccionario"><i class="fa fa-check"></i><b>4.1</b> Visión general del diccionario</a></li>
<li class="chapter" data-level="4.2" data-path="el-diccionario.html"><a href="el-diccionario.html#la-hoja-meta"><i class="fa fa-check"></i><b>4.2</b> La hoja “meta”</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="el-diccionario.html"><a href="el-diccionario.html#el-año"><i class="fa fa-check"></i><b>4.2.1</b> El año</a></li>
<li class="chapter" data-level="4.2.2" data-path="el-diccionario.html"><a href="el-diccionario.html#la-ubicación-de-las-bases-de-datos"><i class="fa fa-check"></i><b>4.2.2</b> La ubicación de las bases de datos</a></li>
<li class="chapter" data-level="4.2.3" data-path="el-diccionario.html"><a href="el-diccionario.html#ubicación-de-los-archivos-validadores"><i class="fa fa-check"></i><b>4.2.3</b> Ubicación de los archivos validadores</a></li>
<li class="chapter" data-level="4.2.4" data-path="el-diccionario.html"><a href="el-diccionario.html#texto-de-la-fuente-para-tabulados"><i class="fa fa-check"></i><b>4.2.4</b> Texto de la fuente para tabulados</a></li>
<li class="chapter" data-level="4.2.5" data-path="el-diccionario.html"><a href="el-diccionario.html#instrucción-para-generar-o-evitar-los-tabulados"><i class="fa fa-check"></i><b>4.2.5</b> Instrucción para generar o evitar los tabulados</a></li>
<li class="chapter" data-level="4.2.6" data-path="el-diccionario.html"><a href="el-diccionario.html#control-del-comportamiento-de-los-scripts"><i class="fa fa-check"></i><b>4.2.6</b> Control del comportamiento de los <em>scripts</em></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="el-diccionario.html"><a href="el-diccionario.html#la-hoja-de-regiones"><i class="fa fa-check"></i><b>4.3</b> La hoja de regiones</a></li>
<li class="chapter" data-level="4.4" data-path="el-diccionario.html"><a href="el-diccionario.html#la-hoja-de-provincias"><i class="fa fa-check"></i><b>4.4</b> La hoja de provincias</a></li>
<li class="chapter" data-level="4.5" data-path="el-diccionario.html"><a href="el-diccionario.html#la-hoja-con-las-cortes-de-apelaciones"><i class="fa fa-check"></i><b>4.5</b> La hoja con las Cortes de Apelaciones</a></li>
<li class="chapter" data-level="4.6" data-path="el-diccionario.html"><a href="el-diccionario.html#la-hoja-de-delitos"><i class="fa fa-check"></i><b>4.6</b> La hoja de delitos</a></li>
<li class="chapter" data-level="4.7" data-path="el-diccionario.html"><a href="el-diccionario.html#la-hoja-de-familias-de-delitos"><i class="fa fa-check"></i><b>4.7</b> La hoja de familias de delitos</a></li>
<li class="chapter" data-level="4.8" data-path="el-diccionario.html"><a href="el-diccionario.html#la-hoja-de-accidentes"><i class="fa fa-check"></i><b>4.8</b> La hoja de accidentes</a></li>
<li class="chapter" data-level="4.9" data-path="el-diccionario.html"><a href="el-diccionario.html#hojas-con-los-títulos"><i class="fa fa-check"></i><b>4.9</b> Hojas con los títulos</a></li>
<li class="chapter" data-level="4.10" data-path="el-diccionario.html"><a href="el-diccionario.html#hojas-con-las-notas-al-pie"><i class="fa fa-check"></i><b>4.10</b> Hojas con las notas al pie</a></li>
<li class="chapter" data-level="4.11" data-path="el-diccionario.html"><a href="el-diccionario.html#hojas-con-series-temporales"><i class="fa fa-check"></i><b>4.11</b> Hojas con series temporales</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="el-archivo-validador.html"><a href="el-archivo-validador.html"><i class="fa fa-check"></i><b>5</b> El archivo validador</a>
<ul>
<li class="chapter" data-level="5.1" data-path="el-archivo-validador.html"><a href="el-archivo-validador.html#contenido-y-estructura-del-archivo-validador"><i class="fa fa-check"></i><b>5.1</b> Contenido y estructura del archivo validador</a></li>
<li class="chapter" data-level="5.2" data-path="el-archivo-validador.html"><a href="el-archivo-validador.html#resultado-de-la-validación"><i class="fa fa-check"></i><b>5.2</b> Resultado de la validación</a></li>
<li class="chapter" data-level="5.3" data-path="el-archivo-validador.html"><a href="el-archivo-validador.html#precauciones"><i class="fa fa-check"></i><b>5.3</b> Precauciones</a></li>
</ul></li>
<li class="part"><span><b>TERCERA PARTE: ESTRUCTURA DEL SISTEMA DE SCRIPTS</b></span></li>
<li class="chapter" data-level="" data-path="presentación-de-la-tercera-parte.html"><a href="presentación-de-la-tercera-parte.html"><i class="fa fa-check"></i>Presentación de la tercera parte</a></li>
<li class="chapter" data-level="6" data-path="estructura.html"><a href="estructura.html"><i class="fa fa-check"></i><b>6</b> La estructura del script</a>
<ul>
<li class="chapter" data-level="6.1" data-path="estructura.html"><a href="estructura.html#el-flujo-de-init.r"><i class="fa fa-check"></i><b>6.1</b> El flujo de init.R</a></li>
<li class="chapter" data-level="6.2" data-path="estructura.html"><a href="estructura.html#generación-de-tabulados-y-validaciones"><i class="fa fa-check"></i><b>6.2</b> Generación de tabulados y validaciones</a></li>
<li class="chapter" data-level="6.3" data-path="estructura.html"><a href="estructura.html#localización-de-bugs"><i class="fa fa-check"></i><b>6.3</b> Localización de bugs</a></li>
<li class="chapter" data-level="6.4" data-path="estructura.html"><a href="estructura.html#ejecución-del-script"><i class="fa fa-check"></i><b>6.4</b> Ejecución del script</a></li>
</ul></li>
<li class="part"><span><b>ANEXOS</b></span></li>
<li class="chapter" data-level="" data-path="anexo1.html"><a href="anexo1.html"><i class="fa fa-check"></i>Anexo 1: Nombres de variables de bases de datos</a></li>
<li class="chapter" data-level="" data-path="anexo-2-mejoras-pendientes-al-script-v-0-1.html"><a href="anexo-2-mejoras-pendientes-al-script-v-0-1.html"><i class="fa fa-check"></i>Anexo 2: Mejoras pendientes al script v. 0.1</a>
<ul>
<li class="chapter" data-level="" data-path="anexo-2-mejoras-pendientes-al-script-v-0-1.html"><a href="anexo-2-mejoras-pendientes-al-script-v-0-1.html#mejoras-planificadas"><i class="fa fa-check"></i>Mejoras planificadas</a></li>
<li class="chapter" data-level="" data-path="anexo-2-mejoras-pendientes-al-script-v-0-1.html"><a href="anexo-2-mejoras-pendientes-al-script-v-0-1.html#mejoras-a-evaluar"><i class="fa fa-check"></i>Mejoras a evaluar</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="anexo3.html"><a href="anexo3.html"><i class="fa fa-check"></i>Anexo 3: Diagrama de flujo: generación automatizada de tabulados de SPyJ</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Manual de uso de scritps de automatización de tabulados de Registros Administrativos de Seguridad Pública y Justicia</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="las-bases-de-datos" class="section level1" number="3">
<h1><span class="header-section-number"> 3</span> Las bases de datos</h1>
<p>Como se mencionaba, cada fuente administrativa remite la información necesaria para que el INE produzca sus estadísticas en formatos propios. No ha habido un proceso de estandarización la información pedida ni en la forma de remitirla, como se establece en el <strong>Manual de Protocolos de Automatización</strong>. Y esto genera un importante problema para un código de automatización que sea capaz de generar productos a partir de dos o más fuentes administrativas: debe ser capaz de procesar información con distintas estructuras y formatos.</p>
<p>Hay dos alternativas para lidiar con este problema. La primera es evitar la manipulación de las bases de datos y ajustar el código de los <em>scripts</em> de automatización a cada formato distinto de cada base de datos distinta. La segunda alternativa es intervenir y modificar manualmente las bases de datos para estandarizarlas; así, un único código general es capaz de generar cualquier tabulado.</p>
<p>Las dos alternativas tienen ventajas y desventajas. En el primer caso, se mantendría la integridad de los datos; se procesarían tal y como han sido remitidos por la fuente. Pero eso a costo de escribir un código muy largo e ineficiente para que pueda hacerse cargo de problemas y formatos específicos y puntuales de cada base de datos. La Corporación Adminsitrativa del Poder Judicial, por ejemplo, remite 18 bases de datos con al menos 8 estructuras y formatos distintos. Para que el <em>script</em> respectivo pudiera procesar todos esas distintas variantes, tendría que contener un código largo y más lento. Esta solución, además, tendría un limitación importante: si los próximos años se produce alguna modificación de la estructura o de los formatos de los datos remitidos por la fuente administrativa, sería necesario intervenir nuevamente el <em>script</em> para agregar o adaptar código a las nuevas estructuras o formatos.</p>
<p>La segunda solución, la intervención manual en las bases, permite dos cosas fundamentales: por un lado, escribir un único código con funciones para procesar todos los tipos y formatos de bases de datos; y, por el otro lado, permite reducir las posibilidad de intervenir los contenidos y las funciones del script en caso de que en futuras versiones de los datos se produzca algún cambio de estructura o formato. Y hay una ventaja adicional: interviniendo manualmente las bases para adaptarlas al código del sistema de <em>scripts</em>, es posible usar este mismo script para desarrollar código que permita generar tabulados de fuentes distintas a las contempladas inicialmente en el desarrollo del código. En otros términos, adoptando esta segunda solución, este mismo sistema de <em>scripts</em> puede usarse para automatizar la generación de tabulados de fuentes distintas a las que alimentan las estadísticas de SPyJ.</p>
<p>Dos son las desventajas de esta segunda solución. La primera: exige alterar los datos de origen. La segunda: no es posible adelantarse a todas las variaciones posibles que incluirán las bases de datos en el futuro. Por lo tanto, la estandarización tiene un techo, y es altamente improbable que no sea necesario ajustar el código de los <em>scripts</em> cada año para que pueda procesar nuevos datos. Las potenciales intervenciones al código con esta solución, sin embargo, son menores en cantidad y profundidad que con la primera solución.</p>
<p>En vista de las ventajas y desventajas de las dos posibles soluciones, para el sistema de <em>scripts</em> de automatización de tabulados y validaciones de SPyJ se ha optado por una combinación de ambas. Se estandarizan elementos generales de las bases de datos, en particular nombres y formatos de variables y algunos formatos de datos. Pero, a la vez, se evita alterar el contenido fundamental de cada base de datos. Las funciones del script han sido escritas para aprovechar lo que se puede estandarizar y también para que tengan la flexibilidad suficiente para procesar diversas estructuras y formatos.</p>
<p>La solución híbrida adoptada es eficaz, pero exige precisión en la intervención manual de las bases de datos para ajustarlas al código de los <em>scripts</em>. ¨El presente capítulo detalla las principales instrucciones para realizar ese proceso.</p>
<p>Estas instrucciones deben seguirse de forma estricta; salvo por el formato de los archivos de las bases de datos, no hay alternativas posibles entre las que elegir en el tratamiento y manipulación de las bases.</p>
<div id="los-formatos-admitidos" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Los formatos admitidos</h2>
<p>Los <em>scripts</em> admiten tres formatos de bases de datos: csv, xlsx y rds. Los dos primeros, csv y xlsx, son de uso masivo y relativamente estandarizado. Por esta razón, es altamente probable que las fuentes administrativas remitan sus datos en alguno de ellos.</p>
<p>También es probable que para bases de datos de más de 1.000.000 de casos, algunas fuentes administrativas usen el formato binario de Excel (xlsb). Este formato, sin embargo, se carga de forma algo errática en R; hasta donde se han testeado para el desarrollo del presente sistema de <em>scripts</em>, ninguna de las librerías disponibles para su tratamiento es capaz de cargar de forma óptima la totalidad de archivos xlsb con los que se ha probado. Por esta razón, se ha descartado en el script el soporte a la carga de datos en ese formato. Para que pueda procesar un archivo remitido por las fuentes administrativas en este formato, es necesario transformarlo antes a formato csv a través de Excel.</p>
<p>Los <em>scripts</em> tampoco tienen soporte para archivos xls. Si la fuente remite alguno en este formato, debe convertirse a formato xlsx a través de Excel.</p>
<p>El rds, por su parte, es un formato interno de R. Es el más eficaz en velocidad de procesamiento, consumo de memoria RAM y espacio ocupado en disco. Sin embargo, por ser un formato interno de R, es altamente improbable que las fuentes administrativas lo ocupen para remitir la información al INE. Salvo por R y Python (con el módulo <code>pyreadr</code>), ningún otro programa es capaz de guardar o leer datos en este formato. Para generar el archivo, por tanto, es necesario cargar en R las bases de datos en otros formatos para luego guardarlas en rds.</p>
<p>Para el proceso de automatización, los archivos de las bases de datos se cargan a través del diccionario. Y, como se mencionaba, pueden estar en cualquiera de los tres formatos indicados. Sin embargo, por eficiencia en tiempo de procesamiento, uso de RAM y espacio de almacenamiento en disco, el flujo de trabajo y procesamiento recomendado es el que se menciona en el párrafo anterior: transformar los archivos que llegan de la fuente administrativa a formato rds.</p>
<div id="la-base-de-datos-la-unidad-fundamental" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> La base de datos: la unidad fundamental</h3>
<p>Existe gran catidad de formatos de archivo en los que se pueden almacenar bases de datos. Debido a la masificación de las herramientas de libros de cálculo como Excel, se ha convertido en costumbre almacenar muchas bases de datos en un único archivo separadas por hojas de cálculo.</p>
<p>Esta costumbre genera una complejidad innecesaria para el procesamiento automatizado de datos. La carga de archivos a través de programación requeriría muchas líneas de código para poder identificar exactamente las hojas de cálculo que contiene la base de datos que nos interesa cargar.</p>
<p>Para evitar esta complejidad, en la automatización de SPyJ se tomará como unidad la base de datos, no el archivo que las contiene. Es decir, si una fuente administrativa remite dos, tres, cuatro o más bases de datos en distintas hojas de un único archivo Excel, para que puedan ser procesadas por el script deben guardarse en archivos independientes, uno por cada base de datos. Así, si, por ejemplo, la base de datos de tramitación de causas en la Corte Suprema viene en un archivo de Excel con tres hojas de cálculo, una para las causas ingresadas, otra para las causas terminadas y una última para las causas pendientes, entonces cada hoja de cálculo debe guardarse como un archivo independiente que contenga sólo esa hoja, ninguna otra. El diccionario sólo podrá cargar bases de datos que se encuentran en la primera hoja de Excel; no hay forma de indicarle que cargue una hoja de cálculo distinta a la primera.</p>
</div>
<div id="verificación-de-la-integridad-de-las-bases-de-datos" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Verificación de la integridad de las bases de datos</h3>
<p>Aunque se decida no convertir a rds los archivos de las bases de datos, es un paso indispensable e ineludible cargarlos en R antes de ejecutar los <em>scripts</em> de automatización, pues es la única forma de comprobar la integridad de los archivos y que el programa los puede leer sin inconvenientes. Este operación, que para efectos del presente proceso de automatización se denomina “verificación de la integridad de las bases de datos”, debe realizarse siempre que se procesa un archivo de base de datos por primera vez. Y es recomendable replicarla cada vez que se introduzca una modificación importante a la estructura de la base o a los formatos de los datos.</p>
<p>Si en este proceso de verificación de la integridad de las bases de datos se detecta algún error, dos pasos deben seguirse:</p>
<ol style="list-style-type: lower-roman">
<li><p>intentar cargar el mismo archivo con otra librería; el orden de las librerías con las que se debe probar se detalla para cada formato más adelante;</p></li>
<li><p>cuando el archivo cargue sin errores, debe guardarse inmediatamente en formato rds y ser llamado desde el diccionario este archivo rds y no el original. Si la carga de archivos no arroja ningún error, es opcional cargar el archivo en formato rds a través del diccionario cuando se ejecute el script de automatización. Pero si arroja errores, no puede no cargarse en formato rds desde el diccionario.</p></li>
</ol>
<p>A continuación se indica cómo realizar la carga de bases de datos para la verificación de integridad para archivos csv y xlsx, y luego se indica cómo guardarlos en formato rds. Recuérdese que para cada tipo de archivo es indispensable usar las liberarías que se indican a continuación en el mismo orden en que se presentan.</p>
<div id="archivos-en-csv" class="section level4" number="3.1.2.1">
<h4><span class="header-section-number">3.1.2.1</span> Archivos en csv</h4>
<p>Los archivos en csv son un formato relativamente universal de exportación y distribución de datos. Prácticamente puede ser leído por cualquier tipo de software que procese estadísticas. Incluso puede ser leído por los editores de texto básicos incluidos en la instalación estándar de todos los sistemas operativos (Bloc de notas en Windows, por ejemplo), aunque bases de datos muy grandes en este formato probablemente consuman demasiada memoria RAM cuando son abiertas por estos editores y provoquen que el computador se cuelgue.</p>
<p>Para cargar este tipo de archivos en cualquier tipo de software, es indispensable conocer cuál es el carácter delimitador (también llamado “separador”) usado para separar los datos. El carácter por defecto que usan los programas que los exportan es la coma; de ahí el nombre del formato: <em>comma separated values</em>, csv.</p>
<p>Sin embargo, en los países de habla no inglesa, la coma se usa para separar decimales. Si los datos numéricos de las bases de datos se han creado con esta regla sintáctica, un archivo csv con la coma como delimitador tomaría como dos números distintos a un único número con decimales. Por ello, en países no anglo-parlantes se opta por usar otros caracteres como delimitadores. El más común es el punto y coma. Es el que se recomienda usar para los <em>scripts</em> de automatización en caso de escoger este formato. En cualquier caso, como se verá más adelante, si se usa un archivo csv en el proceso de automatización, los <em>scripts</em> exigen que en el diccionario se explicite el delimitador usado para separar los datos. Por ello es indispensable saber con qué caracter delimitador se creó el archivo csv. Y también se requiere para realizar la verificación de integridad.</p>
<p>Hay múltiples formas de determinar el delimitador usado para separar los valores. El más común para archivos de menos de 1000000 de casos es intentar cargarlo en Excel; el cuadro de diálogo de importación nos sugerirá el uso de un delimitador a partir de la lectura preliminar del archivo. Excel nos mostrará una previsualización de cómo se desplegaría la hoja de cálculo tras la importación. Si el delimitador sugerido no es el correcto, los datos se mostrarán de forma condesada y desordenada.</p>
<div class="figure">
<img src="imagenes/delimitador_incorrecto.png" alt="" />
<p class="caption">Imagen 1. Delimitador o separador incorrecto: los datos se presentan de forma condensada y desordenada</p>
</div>
<p>En ese caso, debe intentarse con cada alternativa de delimitador hasta encontrar el que organice los datos de forma correcta. Ese es el delimitador usado para crear el archivo csv.</p>
<div class="figure">
<img src="imagenes/delimitador_correcto.png" alt="" />
<p class="caption">Imagen 2. Delimitador o separador correcto: los datos se presentan de forma distribuida en celdas y ordenados</p>
</div>
<p>Conociendo el delimitador, ya se puede cargar el archivo para hacer la verificación de integridad. Para ello debe ejecutarse el siguiente comando:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="las-bases-de-datos.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Función 1: carga del archivo con el paquete usado en el script </span></span>
<span id="cb1-2"><a href="las-bases-de-datos.html#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="las-bases-de-datos.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>bbdd<span class="sc">&gt;</span> <span class="er">&lt;</span><span class="sc">-</span> readr<span class="sc">::</span><span class="fu">read_delim</span>(<span class="st">&quot;&lt;/ruta/nombredelarchivo.csv&gt;&quot;</span>, <span class="at">delim =</span> <span class="st">&quot;&lt;delimitador&gt;&quot;</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">decimal_mark =</span> <span class="st">&quot;,&quot;</span>, <span class="at">grouping_mark =</span> <span class="st">&quot;.&quot;</span>))</span></code></pre></div>
<p>Si el archivo carga sin arrojar errores, entonces podrá usarse en el proceso de automatización y cargarse desde el diccionario. En caso de que el código anterior arrojase un error, debe probarse con otras librerías y luego guardarse en formato rds.</p>
<p>El código para la lectura por otra liberaría es el siguiente:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="las-bases-de-datos.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Función 2: carga del archivo con otros paquetes</span></span>
<span id="cb2-2"><a href="las-bases-de-datos.html#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="las-bases-de-datos.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>bbdd<span class="sc">&gt;</span> <span class="er">&lt;</span><span class="sc">-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="sc">&lt;</span><span class="er">/</span>ruta<span class="sc">/</span>nombredelarchivo.csv<span class="sc">&gt;</span><span class="st">&quot;, sep = &quot;</span><span class="sc">&lt;</span>delimitador<span class="sc">&gt;</span><span class="st">&quot;, dec=&quot;</span><span class="sc">&lt;</span>caracter que se usa como separador decimal<span class="sc">&gt;</span><span class="st">&quot;)</span></span></code></pre></div>
<p>Si la carga con esta librería también arrojase error, debe intentarse con la función que trae la base de R. Para ello debe ejecutarse el siguiente comando:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="las-bases-de-datos.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Función 3: carga del archivo con la base</span></span>
<span id="cb3-2"><a href="las-bases-de-datos.html#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="las-bases-de-datos.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>bbdd<span class="sc">&gt;</span> <span class="er">&lt;</span><span class="sc">-</span> <span class="fu">read.delim</span>(<span class="st">&quot;&lt;/ruta/nombredelarchivo.csv&gt;&quot;</span>, <span class="at">delim =</span> <span class="st">&quot;&lt;delimitador&gt;&quot;</span>)</span></code></pre></div>
<p>Si con cualquiera de las funciones posteriores a la 1 se puede leer el archivo, entonces debe exportarse como rds para que el diccionario llame a este archivo convertido.</p>
<p>Si falla la carga del archivo también con esta última función, dos medidas deben tomarse. La primera es revisar el archivo manualmente y comprobar que los datos estén correctos y que la base de datos haya sido limpiada como se indica en el acápite siguiente de este capítulo. Si aún así persisten los errores, entonces sólo queda gestionar el archivo de nuevo con la fuente administrativa. Para más detalles, véase el diagrama de flujo del proceso de automatización de la producción estadística de SPyJ en el <a href="anexo3.html#anexo3">Anexo 3</a></p>
<p>Recuérdese que, como se mencionó en el <a href="reglas-de-formato-y-convenciones-del-manual.html#formatos_manual">capítulo 2</a>, si en cualquiera de estos casos el error consistió en que no se encontró la librería o el paquete, entonces debe instalarse y repetirse la operación. El nombre del paquete con el que se realiza o ejecuta la función es el que está antes de los dos puntos seguidos dobles (::) de la siguiente forma: <nombredepaquete>::<funcion>(). En consecuencia, para instalar el paquete debe ejecutarse la siguiente función:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="las-bases-de-datos.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instalar paquete que falta</span></span>
<span id="cb4-2"><a href="las-bases-de-datos.html#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="las-bases-de-datos.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;&lt;nombredepaquete&gt;&quot;</span>)</span></code></pre></div>
</div>
<div id="archivos-en-xlsx" class="section level4" number="3.1.2.2">
<h4><span class="header-section-number">3.1.2.2</span> Archivos en xlsx</h4>
<p>Para verificar la integridad de los archivos remitidos en formato xlsx recuérdese que <strong>cada base de datos debe ser guardada en un archivo independiente de Excel, que debe contener una única hoja</strong>, la de la base de datos en cuestión. Si el archivo Excel contiene más de una hoja, las funciones siguientes sólo cargarán la primera.</p>
<p>La carga de las bases de datos que se encuentren en Excel se realiza con la siguiente función:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="las-bases-de-datos.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Función 1: carga del archivo con el paquete usado en el script </span></span>
<span id="cb5-2"><a href="las-bases-de-datos.html#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="las-bases-de-datos.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>bbdd<span class="sc">&gt;</span> <span class="er">&lt;</span><span class="sc">-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">&quot;&lt;/ruta/nombredelarchivo.xlsx&gt;&quot;</span>,  <span class="at">detectDates =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Si la función anterior arroja error, entonces debe intentarse con la siguiente:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="las-bases-de-datos.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Función 2: carga del archivo con otros paquetes</span></span>
<span id="cb6-2"><a href="las-bases-de-datos.html#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="las-bases-de-datos.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>bbdd<span class="sc">&gt;</span> <span class="er">&lt;</span><span class="sc">-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&quot;&lt;/ruta/nombredelarchivo.xlsx&gt;&quot;</span>)</span></code></pre></div>
<p>Si con cualquiera de las funciones posteriores a la 1 se puede leer el archivo, entonces debe exportarse como rds para que el diccionario llame a este archivo convertido.</p>
<p>Si falla la carga del archivo también con esta última función, dos medidas deben tomarse. La primera es revisar el archivo manualmente y comprobar que los datos estén correctos y que la base de datos haya sido limpiada y ajustada como se indica en el acápite siguiente de este capítulo. Si aún así persisten los errores, entonces sólo queda gestionar el archivo de nuevo con la fuente administrativa (<a href="anexo3.html#anexo3">Anexo 3</a>).</p>
</div>
<div id="rds" class="section level4" number="3.1.2.3">
<h4><span class="header-section-number">3.1.2.3</span> Archivos en RDS</h4>
<p>Si el archivo que se va usar para generar tabulados y/o validar con el script se encuentra en formato rds, implica que R debiera poder leerlo sin inconvenientes. Sin embargo, para evitar problemas posteriores, se recomienda también determinar si carga o no. Para ello, debe ejecutarse el siguiente código:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="las-bases-de-datos.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Función 1: carga del archivo en formato rds </span></span>
<span id="cb7-2"><a href="las-bases-de-datos.html#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="las-bases-de-datos.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>bbdd<span class="sc">&gt;</span> <span class="er">&lt;</span><span class="sc">-</span> <span class="fu">readRDS</span>(<span class="st">&quot;&lt;/ruta/nombredelarchivo.rds&gt;&quot;</span>)</span></code></pre></div>
<p>Para guardar una base de datos en formato rds, el comando es el siguiente:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="las-bases-de-datos.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardar archivo en rds</span></span>
<span id="cb8-2"><a href="las-bases-de-datos.html#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="las-bases-de-datos.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(<span class="sc">&lt;</span>bbdd<span class="sc">&gt;</span>, <span class="st">&quot;&lt;/ruta/nombredelarchivo.rds&gt;&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="qué-observar-al-realizar-la-verificación-de-integridad" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> ¿Qué observar al realizar la verificación de integridad?</h3>
<p>La verificación de integridad entrega dos resultados:</p>
<ol style="list-style-type: decimal">
<li><p>La posibilidad de lectura de las bases de datos por parte de R;</p></li>
<li><p>La lectura correcta de los datos por parte de R.</p></li>
</ol>
<p>Los indicadores para determinar si los objetivos de la verificación se cumplen son los siguientes:</p>
<ol style="list-style-type: decimal">
<li><p>Que el archivo pueda ser cargado sin errores por R. En algunos casos el proceso de carga puede arrojar advertencias (<em>warnings</em>). En principio, no importan. Para la verificación de integridad es relevante sólo si el archivo se carga sin errores. Si en RStudio aparece el objeto con los datos en el panel del entorno global (<em>Global Enviroment</em>) y no existe ningún mensaje de error en la consola, entonces se ha cargado correctamente. Puede ser relevante tomar nota de las advertencias (<em>warnings</em>), pero que existan no afecta en nada a la verificación. Sólo la presencia o ausencia de mensajes de error son relevantes para determinar la integridad.</p></li>
<li><p>Que los tipos de dato de cada variable del objeto que contiene la base de datos se correspondan con el tipo de dato que se supone debiera contener, especialmente si el tipo ha sido definido en el proceso de limpieza descrito en la siguiente sección del capítulo. Correspondencia del tipo de datos supone que los datos numéricos sean leídos como numéricos (“numeric” o “integer”), los de cadena como caracter (chr), y así sucesivamente. Si alguna variable se carga en R como lista (list), entonces hay un error de lectura en los datos y el script no va a poder leer y procesar esa base de datos. Además, especialmente sensibles son los datos que contienen fechas completas (año, mes y día). R tiene que leerlas como fecha (no como número) y en el formato específico usado en automatización siguiendo el estándar ISO 8601: año-mes-día. De lo contrario, hay un error en la lectura de datos de esa variable que debe corregirse manualmente.</p></li>
</ol>
<p>Para determinar qué tipos de datos contiene cada variable o columna del objeto con la base de datos, debe ejecutarse la siguiente función:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="las-bases-de-datos.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Corroborar los tipos y formatos de datos</span></span>
<span id="cb9-2"><a href="las-bases-de-datos.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="las-bases-de-datos.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="sc">&lt;</span>bbdd<span class="sc">&gt;</span>)</span></code></pre></div>
<p>Si no se cumple alguna de las condiciones mencionadas, entonces la base de datos no ha pasado la verficación y deben hacerse ajustes. Para el indicador 1, ya se ha indicado qué procedimiento debe seguirse. Para el indicador 2, deben ajustarse manualmente los archivos de las bases de datos siguiendo los procedimientos que se indican a continuación, en la segunda parte de este capítulo.</p>
<hr />
</div>
</div>
<div id="el-ajuste-de-la-estructura-y-los-tipos-de-información-de-las-bases-de-datos" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> El ajuste de la estructura y los tipos de información de las bases de datos</h2>
<p>Como se mencionaba, cada fuente administrativa remite sus bases de datos con formatos y estructuras propias. Eso exige realizar intervenciones manuales en los archivos respectivos para estandarizarlas. Estandarizadas pueden ser procesadas por los <em>script</em>.</p>
<p>Al igual que la verificación de integridad, el ajuste y las modificaciones de las bases de datos son un requisito ineludible: no se pueden usar con los <em>scripts</em> de automatización las que no han pasado por este proceso. En todos los casos, dichas modificaciones debe realizarse siguiendo estrictamente y al pie de la letra las siguientes instrucciones.</p>
<p>Para que las instrucciones de este manual sean más comprensibles, se explicaron primero los formatos de archivos de las bases de datos. Sin embargo, se recomienda partir por el proceso de ajuste manual de las bases de datos antes de hacer la verificación de integridad. El flujo de trabajo es más eficiente si la verificación de integridad se realiza en archivos ya estandarizados.</p>
<div id="la-limpieza-de-la-base-de-datos" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> La limpieza de la base de datos</h3>
<p>La primera operación de estandarización es la limpieza de los archivos de cada base de datos. La limpieza consiste en tres operaciones: i) dejar en el archivo sólo las filas y las columnas necesarias para el procesamiento; ii) modificar los nombres de las columnas para que coincidan con las que los <em>scripts</em> van a procesar; y iii) eliminar “impurezas” en los datos que pueden alterar el procesamiento por parte de los <em>scripts</em>, en particular la “impureza” de los espacios en blanco antes o después del contenido de cada dato.</p>
<p>Todas las operaciones deben hacerse siguiendo los siguientes criterios:</p>
<div id="primeras-filas" class="section level4" number="3.2.1.1">
<h4><span class="header-section-number">3.2.1.1</span> Primeras filas</h4>
<p><strong>La primera fila de cualquier base de datos debe ser la fila que contiene el nombre de las variables o columnas</strong>. Cualquier otra primera fila generará un error en la ejecución de los <em>scripts</em> de automatización. Por ello, las filas que estén por encima de la fila del nombre de las columnas o variables, deben ser eliminadas.</p>
<p>Aunque las bases de datos con primeras filas distintas a los nombres de las columnas o variables son comunes en todas las fuentes administrativas, son especialmente frecuentes en los archivos que provienen de la Corporación Administrativa del Poder Judicial. En ellos debe tenerse especial precaución al respecto.</p>
</div>
<div id="segundas-filas" class="section level4" number="3.2.1.2">
<h4><span class="header-section-number">3.2.1.2</span> Segundas filas</h4>
<p>Las segundas filas de todas las bases de datos deben corresponder al primer registro de datos. No pueden estar compuestas por otros títulos, subtítulos o nombres de variables.</p>
</div>
<div id="celdas-combinadas" class="section level4" number="3.2.1.3">
<h4><span class="header-section-number">3.2.1.3</span> Celdas combinadas</h4>
<p>Ninguna base de datos puede contener celdas combinadas. Su presencia en algún archivo ingresado en el proceso de automatización arrojará error.</p>
</div>
<div id="filas-de-totales" class="section level4" number="3.2.1.4">
<h4><span class="header-section-number">3.2.1.4</span> Filas de totales</h4>
<p>Otras filas que deben ser eliminadas de las bases de datos son las filas con la suma de los totales. Si quedan en las bases de datos, generarán una distorsión en los valores procesados por los <em>scripts</em>, que arrojará tabulados con resultados incorrectos.</p>
</div>
<div id="limpieza-de-columnas-o-variables" class="section level4" number="3.2.1.5">
<h4><span class="header-section-number">3.2.1.5</span> Limpieza de columnas o variables</h4>
<p>Las bases de datos que llegan de las fuentes administrativas traen columnas o variables que no son necesarias para que los <em>scripts</em> genere los tabulados y la validación. Para reducir los tiempos de carga de bases de datos, consumo de memoria RAM y espacio de almacenamiento en disco, lo recomendable es eliminarlas. Dejarlas en el archivo no afectará mayormente al resultado del procesamiento automatizado, pero para la eventualidad de computadores con bajo rendimiento, lo recomendable es reducir el tamaño de las bases de datos al mínimo necesario.</p>
<p>Las columnas necesarias para ejecutar cada <em>script</em> se detallan en el <a href="anexo1.html#anexo1">Anexo 1</a> para todas y cada una de las bases de datos que se requieren para producir los tabulados y las validaciones de los productos de la Unidad de Seguridad Pública y Justicia</p>
</div>
<div id="los-nombres-de-las-variables" class="section level4" number="3.2.1.6">
<h4><span class="header-section-number">3.2.1.6</span> Los nombres de las variables</h4>
<p>Cada fuente administrativa remite bases de datos con nombres de variables definidas para su sistemas de administración y gestión de información. Dichos nombres, aunque remitan a una misma variable, son distintos entre la bases de datos de cada fuente administrativa. En algunos caso, incluso una misma fuente administrativa remite dos bases de datos que contienen la misma variable pero con nombres distintos.</p>
<p>Para impedir que esto represente un problema en el procesamiento automatizado de las bases de datos, se requieren la estandarización de nombres de variables. Los nombres de las variables de cada base de datos están especificados en el <a href="anexo1.html#anexo1">Anexo 1</a>. Deben copiarse en los archivos de las bases de datos tal y como están escritos en dicho anexo. Además, es recomendable, aunque no requisito ineludible, mantener el orden de las variables que se muestra en el anexo, lo que supone mover columnas en los archivos de las bases de datos respectivos.</p>
<p>Deben respetarse las siguientes reglas generales de nombres de variables o columnas:</p>
<ul>
<li><p>los nombres deben escribirse siempre en minúscula;</p></li>
<li><p>los nombres no pueden contener ningún otro carácter que no sea una letra, un número o un guión bajo;</p></li>
<li><p>los espacios deben ser sustituidos por guiones bajos;</p></li>
<li><p>los de las variables que se encuentran detallados en el anexo 1 han sido elegidos en base a estos criterios: que puedan ser uniformes en todas las bases de datos en las que se encuentran y que además sean significativos y autoevidentes, es decir, que cualquiera que esté familiarizado con los cuadros o con las bases de datos pueda interpretar su significado. Es fundamental mantener estos criterios en el caso de incorporar nuevas variables al proceso de generación de cuadros.</p></li>
</ul>
</div>
<div id="eliminación-de-espacios-en-blanco" class="section level4" number="3.2.1.7">
<h4><span class="header-section-number">3.2.1.7</span> Eliminación de espacios en blanco</h4>
<p>Uno de los principales problemas con los que debe lidiar el procesamiento automatizado de bases de datos que no han sido generadas con fines estadísticos es el de la limpieza de cada dato. Cuando los sistemas de gestión no han sido diseñados pensando en criterios estadísticos, los valores se guardan como cadenas que deben ser introducidas por cada usuario del sistema. Y eso es fuente de errores importantes. El más fundamental es registrar información para un mismo valor pero con distintos formato de registros. Por ejemplo, en una misma variable de una misma base de datos se registran de dos formas distintas una región: como “Región Metropolitana” o como “Región Metropolitana de Santiago”.</p>
<p>Todas las bases de datos de los Registros Administrativos que se procesan en la Unidad de Seguridad Pública y Justicia están plagadas de estos errores y problemas de limpieza de información. En algunos casos hay más problemas que en otros, pero todas las bases los presentan.</p>
<p>Como se indica en el <strong>Manual de Protocolos de Automatización</strong>, la única forma de evitar estos problemas es con bases de datos que registran códigos y se acompañan de un libro de códigos o diccionario de variables. Pero eso supone diseñar los sistemas de gestión y registro de información administrativa para que almacene códigos y no cadenas o caracteres. Con los registros administrativos con los que trabajan la unidad, eso ya no fue posible. Por lo tanto, Sólo queda hacer limpieza de las bases a posteriori.</p>
<p>Parte importante de la limpieza se hace a través de el código de los <em>scripts</em>. Sin embargo, hay algunos problemas que son más difíciles de detectar y que requieren funciones complejas para que puedan ser identificados y resueltos. El principal es la existencia de espacios en blanco antes o después de un dato. Este problema es significativo porque altera el tipo de dato: un dato numérico que tiene un espacio antes o después del número genera errores de procesamiento en cualquier lenguaje de programación o software estadístico.</p>
<p>La mejor forma de evitar esto es eliminando esos espacios en blanco previos o posteriores a los datos antes de ingresar la base al proceso de automatización. El último paso, por lo tanto, de la limpieza de bases de datos consiste en eliminar estos caracteres de espacios. Para ello debe usarse la función <code>=ESPACIO(&lt;celda&gt;)</code> de Excel en todos los archivos que se puedan leer desde este programa.</p>
</div>
</div>
<div id="los-tipos-de-información-de-las-celdas" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Los tipos de información de las celdas</h3>
<p>La segunda operación de ajuste de las bases de datos consiste en definir explícitamente los tipos de datos que contiene cada columna. En términos estrictos, R interpreta los datos que carga de forma bastante eficaz. Sin embargo, la sola existencia de un dato discordante con el resto en una columna hará que R clasifique de forma distinta a la esperada a la información de toda esa columna. Por ello, debe realizarse esta operación de explicitación del tipo de dato al menos la primera vez que se interviene una base de datos.</p>
<div id="formatos-generales" class="section level4" number="3.2.2.1">
<h4><span class="header-section-number">3.2.2.1</span> Formatos generales</h4>
<p>Los formatos se establecen de forma fácil en Excel. Para ello debe abrirse la base de datos, marcar todas las celdas de una columna excepto la del nombre (la primera fila), y elegir el tipo adecuado en el menú “Formato”.</p>
<p>Importa especialmente definir el formato de los siguientes tipos de datos:</p>
<ul>
<li><p>numéricos;</p></li>
<li><p>cadenas o caracteres;</p></li>
<li><p>fechas</p></li>
</ul>
</div>
<div id="las-fechas" class="section level4" number="3.2.2.2">
<h4><span class="header-section-number">3.2.2.2</span> Las fechas</h4>
<p>Las fechas son el tipo de dato más delicado debido a que se pueden escribir en múltiples formatos, y la interpretación incorrecta del formato por parte del script genera errores en el procesamiento de la información que detienen la ejecución del código. En el caso de los Registros Administrativos con los que trabaja SPyJ, cada fuente remite la información sobre fechas con el formato que más le acomoda. Muchas veces, dos bases de datos distintas de la misma fuente tiene dos formatos de fecha distintos. Básicamente, las fuentes no tienen criterios definidos ni tampoco mucho cuidado para trabajar las fechas.</p>
<p>Para evitar los problemas que genera la diversidad de formatos, la Organización Internacional para la Estandarización (ISO por su nombre en inglés) ha definido un estándar (ISO 8601) para trabajar con datos sobre fechas que es el que se aplica en el presente sistema de <em>scripts</em> y se recomienda respetar en todo proyecto de automatización de estadísticas dentro del INE.</p>
<p>La norma ISO 8601 establece que los datos sobre fechas (o, en términos más generales, sobre temporalidad) deben escribirse en orden descendente, de izquierda a derecha, según el grado de “amplitud” de cada componente del dato. En una fecha cualquiera, el año es el valor más amplio, luego le sigue el mes, luego el día, la hora, el minuto y el segundo. El estándar establece que en ese orden deben escribirse los datos de fechas: año-mes-dia. Los datos sobre horas, sin fechas, siguen el mismo criterio de amplitud: hora:minutos:segundos.</p>
<p>Hay otras reglas del estándar además del orden de los datos:</p>
<ol style="list-style-type: decimal">
<li><p>El separador de los datos de fecha es el guión;</p></li>
<li><p>El separador de los datos de hora es los dos puntos;</p></li>
<li><p>Si se agrega la hora al dato, se separa de la fecha con la letra T; la media noche del 18 de septiembre de 2021 se escribe de la siguiente forma: 2021-09-18T00:00:00</p></li>
<li><p>También se puede agregar información sobre la zona horaria después de la hora; se escribe con dos caracteres separados por el signo respecto a la hora del meridiano de Greenwich: al oriente, signo positivo; al occidente, signo negativo. Siguiendo el mismo ejemplo anterior, se agrega el huso horario de verano de Chile (tres horas menos que en Greenwich) al 18 de septiembre de 2021 así: 2021-09-18T00:00:00-03:00; el horario de invierno de Chile se muestra así: 2021-09-18T00:00:00-04:00;</p></li>
<li><p>Los años se escriben completos, con cuatro dígitos;</p></li>
<li><p>Todo el resto de los datos se escribe con dos dígitos; los datos para números menores a diez se anteceden de un cero; el 9 de enero de 2021 se escribe así: 2021-01-09;</p></li>
</ol>
<p>Al definir el tipo de dato de las variables de fecha en las bases de datos, deben seguirse estos estándares. Para programar el tratamiento de los datos de fechas en los <em>scripts</em> no era posible generar código para todos los formatos posibles. Como era necesario adoptar un estándar, se optó por el de ISO. Pero para que funcione, es necesario que en la fase de preparación se convierta las fechas en las bases de dato a este formato.</p>
<p>Esto se puede hacer de forma fácil en Excel siguiendo los mismos pasos descritos en el acápite anterior: se selecciona toda una columna menos la primera y en el menú “formato de celdas” se elige “más formatos de números”. En el cuadro de diálogo se elige “Fecha” y en las alternativas se escoge el formato que se ajusta al estándar ISO 8601.</p>
<div class="figure">
<img src="imagenes/Fecha.png" alt="" />
<p class="caption">Imagen 3. Definiendo formato de fechas en Excel</p>
</div>
<p>Por regla general, los archivos exportados a csv automáticamente ajustan el formato de fecha a ISO 8601. De todas formas, debe detectarse si las variables que correspondan tienen el formato correcto en la verificación de integridad. En caso de que eso no ocurra, debe ajustarse el formato. Si la variable contiene sólo fechas, debe aplicarse la siguiente función:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="las-bases-de-datos.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cambiar formato de fecha</span></span>
<span id="cb10-2"><a href="las-bases-de-datos.html#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="las-bases-de-datos.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>bbdd<span class="sc">&gt;</span><span class="er">$&lt;</span>variable de fecha<span class="sc">&gt;</span> <span class="er">&lt;</span><span class="sc">-</span> lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="sc">&lt;</span>bbdd<span class="sc">&gt;</span><span class="er">$&lt;</span>variable de fecha<span class="sc">&gt;</span>, <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>)</span></code></pre></div>
<p>Si la variable contiene fecha y hora, se aplica la siguiente función:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="las-bases-de-datos.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cambiar formato de fecha y hora</span></span>
<span id="cb11-2"><a href="las-bases-de-datos.html#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="las-bases-de-datos.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>bbdd<span class="sc">&gt;</span><span class="er">$&lt;</span>variable de fecha<span class="sc">&gt;</span> <span class="er">&lt;</span><span class="sc">-</span> lubridate<span class="sc">::</span><span class="fu">ymd_hms</span>(<span class="sc">&lt;</span>bbdd<span class="sc">&gt;</span><span class="er">$&lt;</span>variable de fecha<span class="sc">&gt;</span>, <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>)</span></code></pre></div>
<p>Luego debe exportarse/guardarse el objeto que contiene la base de datos como un archivo rds. Véase las instrucción de la sección <a href="las-bases-de-datos.html#rds">sección anterior</a> para ello.</p>
<hr />
</div>
</div>
</div>
<div id="unificación-de-bases-de-datos-divididas-en-múltiples-archivos" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Unificación de bases de datos divididas en múltiples archivos</h2>
<p>Una situación frecuente en las bases de datos de Registros Administrativos es que las fuentes remitan la información dividida en varios archivos. El motivo de esto es que Excel, en sus versiones más recientes, puede procesar y contener hasta un máximo de 1.000.000 de filas aprox. Las bases de datos que contenga más de 1.000.000 de casos, entonces, no pueden ser almacenadas en un archivo de Excel en formato xlsx. La solución por parte de la fuente administrativa, por tanto, es remitir la información dividida en varios archivos de Excel.</p>
<p>Los <em>scripts</em> de automatización no puede procesar bases de datos divididas en varios archivos. Por lo tanto, se requiere unificarlos en un único archivo. Hay varias alternativas manuales para hacer esto a través de Excel. La más simple es crear un libro, guardarlo en formato binario (xlsb), luego copiar y pegar los datos en la primera hoja y luego guardarlo como archivo csv.</p>
<p>Para evitar hacer esto de forma manual, en el sistema de <em>scripts</em> se ha incluido una función que hace la misma operación de forma automatizada. Para que se ejecute correctamente, deben seguirse los siguientes pasos:</p>
<ol style="list-style-type: decimal">
<li><p>Limpiar y estandarizar todos y cada uno de los archivos en que se divide la base de datos siguiendo las instrucciones de este capítulo; si sólo se estandarizan y limpian algunos y no todos, o si no se interviene ninguno, la función podría arrojar error; si no todos tienen los mismos nombres de columnas/variables, definitivamente va a arrojar un error.</p></li>
<li><p>Todos los archivos deben guardarse en formato xslx;</p></li>
<li><p>Todos los archivos deben ser puestos en una carpeta en la que se encuentren únicamente los que forman parte de la base de datos; si hay otro archivo en la carpeta que no se corresponda con la base de datos, la función arrojará error.</p></li>
<li><p>Cargar en R las funciones del script de automatización; para ello, deben seguirse las instrucciones del <a href="estructura.html#estructura">capítulo respectivo</a>.</p></li>
</ol>
<p>Cuando se encuentren todos los archivos en la carpeta y las funciones cargadas, debe ejecutarse la siguiente función:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="las-bases-de-datos.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unificar archivos</span></span>
<span id="cb12-2"><a href="las-bases-de-datos.html#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="las-bases-de-datos.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unificar_archivos</span>(<span class="st">&quot;&lt;ruta/al/directorio&gt;&quot;</span>, <span class="sc">&lt;</span>institución<span class="sc">&gt;</span>, <span class="sc">&lt;</span>bbdd<span class="sc">&gt;</span>, <span class="at">output =</span> <span class="st">&quot;&lt;formato&gt;&quot;</span>)</span>
<span id="cb12-4"><a href="las-bases-de-datos.html#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="las-bases-de-datos.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo para unificar archivos de competencia civil guardados en mis documentos</span></span>
<span id="cb12-6"><a href="las-bases-de-datos.html#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># y exportados en rds:</span></span>
<span id="cb12-7"><a href="las-bases-de-datos.html#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="las-bases-de-datos.html#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">unificar_archivos</span>(<span class="st">&quot;~/Mis Documentos/&quot;</span>, <span class="st">&quot;pjud&quot;</span>, <span class="st">&quot;terminadas_civil&quot;</span>, <span class="at">output =</span> <span class="st">&quot;rds&quot;</span>)</span></code></pre></div>
<p>Todos los argumentos son obligatorios.</p>
<p>La función admite sólo dos formatos de salida (output): rds y csv. Cualquier otro formato, arrojará error.</p>
<p>El resultado de la ejecución es un archivo en la misma carpeta de donde tomó los que unió. Tendrá el siguiente nombre: <code>&lt;bbdd&gt;_&lt;institución&gt;.&lt;formato&gt;</code>. El del ejemplo será el siguiente: <code>terminadas_civil_pjud.rds</code></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="presentación-de-la-segunda-parte.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="el-diccionario.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Manual_Uso_Script_SPyJ.pdf", "Manual_Uso_Script_SPyJ.epub"],
"toc": {
"collapse": "subsection"
},
"highlight": "tango"
});
});
</script>

</body>

</html>
